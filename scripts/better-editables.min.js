!function(){"use strict";$.betterEditableData={},$.betterEditableData.version="0.17.10",$.betterEditableData.utils={stopPropagation:function(t){t.stopPropagation?t.stopPropagation():t.returnValue=!1},preventDefault:function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},getIEVersion:function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>-1)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);var i=t.indexOf("Trident/");if(i>-1){var a=t.indexOf("rv:");return parseInt(t.substring(a+3,t.indexOf(".",a)),10)}var n=t.indexOf("Edge/");return n>-1?parseInt(t.substring(n+5,t.indexOf(".",n)),10):0},normalizeBoolean:function(t){return"boolean"!=typeof t&&(t="string"==typeof t&&"true"===t.toLowerCase()?!0:"number"==typeof t&&1===t?!0:!1),t},normalizeNumber:function(t){return"string"==typeof t&&(t=t.replace(",",".")),null===t||isNaN(t)||"string"==typeof t&&""===t.trim()?t=null:Number(t)},formatNewDate:function(t,e){var i="";if("undefined"==typeof e||null===e)return i;var a=t.date();isNaN(Date.parse(e))?t.date(e):t.date(new Date(e));var n=t.date();return null!==n&&(i=n.format(t.format())),t.date(a),i},requireRecreateInput:["submitOnBlur","clearButton","buttonsOn","inputClass","buttonClass","type","mode","typeSettings"],requireBoolNormalization:["submitNoChange","submitOnBlur","clearButton","buttonsOn","tabbingOn","readOnly"],possibleTypes:["text","password","number","tel","email","textarea","select","bool","inputmask","datetimepicker","autocomplete","multifield"]},$.betterEditableData["default"]={displayFunction:function(t,e){"undefined"==typeof e&&(e=t.value,"select"==t.options.type?e=t.options.selectDisplay(t,e):"textarea"==t.options.type?e=t.options.textareaDisplay(t,e):"bool"==t.options.type?e=t.options.boolDisplay(t,e):"datetimepicker"==t.options.type?e=t.options.dateDisplay(t,e):"multifield"==t.options.type&&(e=t.options.multifieldDisplay(t,e))),t.$element.html(e),"undefined"==typeof e||null===e||""===String(e).trim()?(t.$element.html(t.options.emptyDisplay),t.$element.hasClass("empty")||t.$element.addClass("empty")):t.$element.removeClass("empty")},load:{start:function(t){t.toggleReadOnly(!0),t.$element.text("Submitting...")},end:function(t,e){e.options.displayFunction(e),e.toggleReadOnly(!1)}},onAjaxSuccess:function(t,e){e.options.load.end({data:t,hasError:!1},e)},onAjaxError:function(t,e,i,a,n,o){var s=e.statusText,r=e.status;("string"!=typeof s||""===s.trim())&&(s=t.statusText),"number"==typeof r||"string"==typeof r&&""!==r.trim()||(r=t.status);var l=r+": "+s;o.options.load.end({data:l,hasError:!0},o),o.options.errorHandler(r+": "+s,o,!0),o.show(),o.setInputValue(n)},errorHandler:function(t,e,i){var a=e.$element.attr("id");if(i){var n=!0;if("string"==typeof a&&""!==a){var o=$('[data-valmsg-for="'+a+'"]').first();0==o.length&&(o=$('[data-for="'+a+'"]').first()),o.length>0&&(n=!1,o.text(t).show())}if(n){var o=$("<span></span>").addClass(e.options.errorClass).addClass("editable-error").attr("data-for",a).attr("data-valmsg-for",a).text(t);"popup"===e.options.mode&&"bool"!=e.options.type?"multifield"===e.options.type&&e.options.buttonsOn===!0?e.$inputDiv.find(".editable-button-wrapper").append(o):e.$inputDiv.find(".editable-input-wrapper").append(o):e.$inputDiv.after(o),o.on("click",function(t){e.options.submitOnBlur===!0&&e.state.readOnly===!1&&e.isShown()&&$.betterEditableData.utils.stopPropagation(t)})}}else{var o=$('[data-valmsg-for="'+a+'"]').first();0==o.length&&(o=$('[data-for="'+a+'"]').first()),o.length>0&&o.hide()}},destroyError:function(t){var e=t.$element.attr("id"),i=$('[data-valmsg-for="'+e+'"]').first();0==i.length&&(i=$('[data-for="'+e+'"]').first()),i.length>0&&i.remove()},boolDisplay:function(t,e){return e?"True":"False"},selectDisplay:function(t,e){var i=t.options.typeSettings;if("[object Array]"===Object.prototype.toString.call(i))for(var a=0;a<i.length;++a)if("object"==typeof i[a])if("[object Array]"===Object.prototype.toString.call(i[a])){if(i[a].length>=2&&i[a][0]==e){e=i[a][1];break}}else if(i[a].value==e){e=i[a].text;break}return e},textareaDisplay:function(t,e){var i=new RegExp("(\r|\n|\r\n)","g");return e.replace(i,"<br/>")},dateDisplay:function(t,e){return $.betterEditableData.utils.formatNewDate(t.$input.data("DateTimePicker"),e)},multifieldDisplay:function(t,e){if("object"==typeof e&&null!==e){for(var i="",a=0;a<e.length;++a)Object.keys(e[a]).forEach(function(t){void 0!==typeof e[a][t]&&null!==e[a][t]&&""!==String(e[a][t]).trim()&&(i+=String(e[a][t])+", ")});return""!==i&&(i=i.slice(0,-2)),i}return""}},$.betterEditableData.validators={required:{errorMsg:function(t,e,i){return t+" is required!"},validator:function(t,e,i){return"false"===e||e===!1?!0:"undefined"==typeof t||null==t||""===t?!1:!0}},minlen:{errorMsg:function(t,e,i){return t+" must be atleast "+e+" characters long!"},validator:function(t,e,i){return t.length>0&&t.length<Number(e)?!1:!0}},maxlen:{errorMsg:function(t,e,i){return t+" must not be longer then "+e+" characters!"},validator:function(t,e,i){return t.length>Number(e)?!1:!0}},length:{errorMsg:function(t,e,i){return t+" must be exactly "+e+" characters long!"},validator:function(t,e,i){return t.length>0&&t.length!=Number(e)?!1:!0}},email:{errorMsg:function(t,e,i){return t+" is not a valid email input!"},validator:function(t,e,i){return"undefined"!=typeof t&&null!==t&&""!==t||"false"!==e&&e!==!1?0==t.length||/^.+?@.+?\..+?$/.test(t):!0}},phone:{errorMsg:function(t,e,i){return t+" is not a valid phone number!"},validator:function(t,e,i){return"undefined"!=typeof t&&null!==t&&""!==t||"false"!==e&&e!==!1?0==t.length||/^[+]{0,1}[0-9]+$/.test(t):!0}},disable:{errorMsg:function(t,e,i){return t+" can't be changed at the moment!"},validator:function(t,e,i){return"false"===e||e===!1?!0:!1}},requiredif:{errorMsg:function(t,e,i){return t+" is required!"},validator:function(t,e,i){var a,n=e;if("undefined"!=typeof i.data("requiredif-dependentpropertyid"))a=RequiredIf(n,i.data("requiredif-dependentpropertyid"));else{for(var o,s=0;"undefined"!=typeof i.data("requiredif-dependentpropertyid-"+s);){if(o=i.data("requiredif-desiredvalue-"+s),("undefined"==typeof o||null===o)&&(o=n),a=RequiredIf(o,i.data("requiredif-dependentpropertyid-"+s)),a&&!$.betterEditableData.validators.required.validator(t,e,i))return!1;++s}a=!1}return a?$.betterEditableData.validators.required.validator(t,e,i):!0}},inputmaskvalidate:{errorMsg:function(t,e,i){return t+" is invalid!"},validator:function(t,e,i){var a=i.betterEditable().$input;return"undefined"==typeof a||"undefined"==typeof t||null===t||""===t?!0:a.inputmask("isComplete")}}},$.betterEditableData.methods={getVersion:function(t){return $.betterEditableData.version},getValue:function(t){return t.getValue()},setValue:function(t,e){t.setValue(e),t.options.displayFunction(t)},submit:function(t){t.setInputValue(),t.initiateSubmit(void 0,!0)},setOption:function(t,e,i){if(-1!==$.inArray(e,$.betterEditableData.utils.requireBoolNormalization)&&(i=$.betterEditableData.utils.normalizeBoolean(i)),"readOnly"==e)return void t.toggleReadOnly(i);var a=t.options[e];if(t.options[e]=i,"tabIndex"==e&&t.options.tabbingOn===!0)t.$element.attr("data-tab-index",t.options.tabIndex);else if("tabbingOn"!=e||"string"!=typeof t.options.tabIndex&&"number"!=typeof t.options.tabIndex){if(-1!==$.inArray(e,$.betterEditableData.utils.requireRecreateInput)&&("bool"!=t.options.type||"type"==e)){var n="type"!=e,o="mode"==e&&"popup"==a;t.recreateInputField(n,o)}}else t.$element.attr("data-tab-index",t.options.tabIndex)},getOption:function(t,e){return"readOnly"==e?t.state.readOnly:t.options[e]},getOptions:function(t){return t.options},validate:function(t){return t.validate(!1)},toggleEnable:function(t,e){t.toggleReadOnly(!e)},enable:function(t){t.toggleReadOnly(!1)},disable:function(t){t.toggleReadOnly(!0)},focus:function(t){t.isShown()&&t.focus()},clear:function(t){t.isShown()&&t.clear()},destroy:function(t){t.resetState(),t.hideInput(),t.$inputDiv.remove(),t=null},toggle:function(t,e){e===!0?t.isShown()||t.show():t.isShown()&&t.cancel()},show:function(t){t.isShown()||t.show()},hide:function(t){t.isShown()&&t.cancel()},tab:function(t,e){t.isShown()&&t.canTab()&&(-1!==e&&(e=1),t.state.doTab=e,t.initiateSubmit())},createValidator:function(t,e,i,a){if("undefined"!=typeof $.betterEditableData.validators[e])throw"Validator '"+e+"' already exists!";$.betterEditableData.validators[e]={errorMsg:a,validator:i}},attachValidator:function(t,e,i){if("undefined"==typeof $.betterEditableData.validators[e])throw"Validator '"+e+"' does not exist!";for(var a=-1,n=0;n<t.validators.length;++n)if(t.validators[n]==e){a=n;break}-1===a&&t.validators.push(e),"undefined"!=typeof i&&t.$element.data(e,i)},detachValidator:function(t,e){for(var i=0;i<t.validators.length;++i)if(t.validators[i]==e)return void t.validators.splice(i,1)}},$.betterEditableData.submitting=0,$.betterEditableData.blockTab=!0,window.BetterEditable=function(t){function e(t,e){for(var i=0;i<t.length;++i)if("undefined"!=typeof t[i])return e===!0?$.betterEditableData.utils.normalizeBoolean(t[i]):t[i];return void 0}this.$element=t.$element,this.options={},this.options.url=e([this.$element.data("url"),t.url]),this.options.displayFunction=e([t.displayFunction,function(t,e){return $.betterEditableData["default"].displayFunction(t,e)}]),this.options.fieldName=e([this.$element.data("name"),t.fieldName,this.$element.attr("name"),this.$element.attr("title"),this.$element.attr("id")]),this.options.pk=e([this.$element.data("pk"),t.pk]),this.options.toggle=e([this.$element.data("toggle"),t.toggle,"click"]),this.options.mode=e([this.$element.data("mode"),t.mode]),"popup"!==this.options.mode&&(this.options.mode="inline"),this.options.placement=e([this.$element.data("placement"),t.placement,"right"]),this.options.type=e([this.$element.data("type"),this.$element.attr("type"),t.type]),this.options.typeSettings=t.typeSettings,this.options.ajaxObject=t.ajaxObject,this.options.ajaxParams=t.ajaxParams,this.options.load=e([t.load,{start:function(t){return $.betterEditableData["default"].load.start(t)},end:function(t,e){return $.betterEditableData["default"].load.end(t,e)}}]),this.options.onAjaxError=e([t.onAjaxError,function(t,e,i,a,n,o){return $.betterEditableData["default"].onAjaxError(t,e,i,a,n,o)}]),this.options.onAjaxSuccess=e([t.onAjaxSuccess,function(t,e){return $.betterEditableData["default"].onAjaxSuccess(t,e)}]),this.options.errorHandler=e([t.errorHandler,function(t,e,i){return $.betterEditableData["default"].errorHandler(t,e,i)}]),this.options.destroyError=e([t.destroyError,function(t){return $.betterEditableData["default"].destroyError(t)}]),this.options.submitNoChange=e([this.$element.data("submit-no-change"),t.submitNoChange,!1],!0),this.options.submitOnBlur=e([this.$element.data("submit-on-blur"),t.submitOnBlur,!0],!0),this.options.emptyDisplay=e([this.$element.data("empty-display"),t.emptyDisplay,"n/a"]),this.options.boolDisplay=e([t.boolDisplay,function(t,e){return $.betterEditableData["default"].boolDisplay(t,e)}]),this.options.selectDisplay=e([t.selectDisplay,function(t,e){return $.betterEditableData["default"].selectDisplay(t,e)}]),this.options.textareaDisplay=e([t.textareaDisplay,function(t,e){return $.betterEditableData["default"].textareaDisplay(t,e)}]),this.options.dateDisplay=e([t.dateDisplay,function(t,e){return $.betterEditableData["default"].dateDisplay(t,e)}]),this.options.multifieldDisplay=e([t.multifieldDisplay,function(t,e){return $.betterEditableData["default"].multifieldDisplay(t,e)}]),this.options.clearButton=e([this.$element.data("clear-button"),t.clearButton,!0],!0),this.options.buttonsOn=e([this.$element.data("buttons-on"),t.buttonsOn,!0],!0),this.options.inputClass=e([this.$element.data("input-class"),t.inputClass]),this.options.buttonClass=e([this.$element.data("button-class"),t.buttonClass]),this.options.errorClass=e([this.$element.data("error-class"),t.errorClass]),this.options.tabIndex=e([this.$element.data("tab-index"),t.tabIndex]),this.options.tabbingOn=e([this.$element.data("tabbing-on"),t.tabbingOn,!1],!0),this.$element.attr("data-editable",""),this.options.tabbingOn!==!0||"string"!=typeof this.options.tabIndex&&"number"!=typeof this.options.tabIndex||this.$element.attr("data-tab-index",this.options.tabIndex),this.state={},this.resetState(),this.state.popupOpen=!1,this.createInputField(),this.setValue(e([this.$element.data("value"),t.value,this.$element.attr("value"),this.$element.text()])),this.setInputValue(),this.initializeValidators(),this.options.displayFunction(this),t.readOnly===!0?this.toggleReadOnly(!0):this.state.readOnly=!1;var i=this,a=function(t){$.betterEditableData.utils.stopPropagation(t),i.show(),"bool"!=i.options.type||i.isReadOnly()||i.$input.trigger("click")};this.$element.on("click",function(t){"click"===i.options.toggle&&a(t)}),this.$element.on("dblclick",function(t){"doubleclick"===i.options.toggle&&a(t)}),this.$element.on("mouseenter",function(t){"mouseenter"===i.options.toggle&&a(t)}),this.$element.addClass("editable-ready"),this.$element.trigger("be.init",this)},BetterEditable.prototype.initializeValidators=function(){this.validators=[];var t=this.$element.data();for(var e in t)"undefined"!=typeof $.betterEditableData.validators[e]&&this.validators.push(e)},BetterEditable.prototype.createInputField=function(){var t=this,e=this.options.type;if(-1===$.inArray(e,$.betterEditableData.utils.possibleTypes)&&(e="text"),this.$inputDiv=$("<div></div>").attr("data-editable-div","").addClass(this.options.mode).addClass(e).addClass("editable-input-div").addClass(this.options.inputClass),this.$input=null,"textarea"==e)this.$input=$("<textarea></textarea>");else if("select"==e){this.$input=$("<select></select>");var i=this.options.typeSettings;if("[object Array]"===Object.prototype.toString.call(i))for(var a=0;a<i.length;++a)"object"==typeof i[a]&&("[object Array]"===Object.prototype.toString.call(i[a])?i[a].length>=2&&this.$input.append($("<option>",{value:i[a][0],text:i[a][1]})):this.$input.append($("<option>",{value:i[a].value,text:i[a].text})))}else if("bool"==e)this.$input=$("<input></input>").attr("type","hidden");else if("inputmask"==e)this.$input=$("<input></input>").attr("type","text"),"undefined"!=typeof this.options.typeSettings?this.$input.inputmask(this.options.typeSettings.mask,this.options.typeSettings.settings):this.$input.inputmask();else if("datetimepicker"==e)this.$input=$("<input></input>").attr("type","text").attr("onkeydown","return false");else if("autocomplete"==e){this.$input=$("<input></input>").attr("type","text");var n=$.extend({},this.options.typeSettings),o="editable-autocomplete-list editable-autocomplete-"+this.options.mode;"undefined"==typeof n.classes?n.classes={"ui-autocomplete":o}:"[object Object]"===Object.prototype.toString.call(n.classes)&&("undefined"==typeof n.classes["ui-autocomplete"]?n.classes["ui-autocomplete"]=o:"string"==typeof n.classes["ui-autocomplete"]&&(n.classes["ui-autocomplete"]+=" "+o)),this.$input.autocomplete(n)}else"multifield"==e?(this.$input=$("<div></div>").addClass("editable-multifield-wrapper"),"[object Object]"===Object.prototype.toString.call(this.options.typeSettings)&&Object.keys(this.options.typeSettings).forEach(function(e){var i=e,a=e,n=t.options.typeSettings[e];if("[object Array]"===Object.prototype.toString.call(n)){if(0===n.length)throw"Empty array given as field type!";1===n.length?(n=n[0],i+=": "):(i=n[1],n=n[0])}else i+=": ";var o,s,r=$("<div></div>").addClass("editable-multifield-input-wrapper").addClass(n+"-type");o="textarea"===n?$("<textarea></textarea>"):$("<input></input>").attr("type",n),o.attr("name",a).addClass("editable-multifield-input"),"checkbox"===n?(s=$("<label></label>").addClass("editable-multifield-label").addClass("checkbox-type"),s.append(o).append(i),r.append(s)):(s=$("<div></div>").addClass("editable-multifield-label"),"string"==typeof i&&""!==i.trim()&&"hidden"!==n&&s.text(i),r.append(s),r.append(o)),t.$input.append(r)})):this.$input=$("<input></input>").attr("type",e);var s=$("<div></div>").addClass("editable-input-wrapper");if("bool"!=this.options.type&&this.options.submitOnBlur!==!1&&($(document).on("click",function(e,i,a){if("undefined"!=typeof e.originalEvent&&(e=e.originalEvent),t.options.submitOnBlur===!0&&t.state.readOnly===!1&&t.isShown()){if("autocomplete"==t.options.type)if("undefined"!=typeof e.path){for(var n=0;n<e.path.length;++n)if($(e.path[n]).hasClass("ui-autocomplete"))return}else for(var o in e.target.parentNode)if(e.target.parentNode.hasOwnProperty(o)){var s=e.target.parentNode[o];for(var r in s)if(s.hasOwnProperty(r)&&"uiAutocompleteItem"==r)return}t.initiateSubmit()}}),this.$inputDiv.on("click",function(e){t.options.submitOnBlur===!0&&t.state.readOnly===!1&&t.isShown()&&$.betterEditableData.utils.stopPropagation(e)})),"bool"===this.options.type)this.$input.on("click",function(){t.setInputValue(!t.getValue()),t.initiateSubmit()});else{var r=this.$input,l=function(e){$.betterEditableData.utils.preventDefault(e),t.cancel()},p=function(e,i){("TEXTAREA"!=$(e.target).prop("tagName")||e.ctrlKey)&&($.betterEditableData.utils.preventDefault(e),t.canTab()&&i!==!0&&(e.shiftKey?t.state.doTab=-1:t.state.doTab=1),t.initiateSubmit())},d=function(e){t.canTab()&&($.betterEditableData.utils.preventDefault(e),e.shiftKey?t.state.doTab=-1:t.state.doTab=1,t.initiateSubmit())};"multifield"===this.options.type?(r=this.$input.find('input:not([type="hidden"]), textarea').last(),this.$input.find('input:not([type="hidden"]), textarea').each(function(){return $(this)==r?!0:void $(this).on("keydown",function(t){27==t.which?l(t):13==t.which&&p(t,!0)})}),r.off("keydown"),r.on("keydown",function(t){27==t.which?l(t):13==t.which?p(t):9==t.which&&d(t)})):r.on("keydown",function(t){27==t.which?l(t):13==t.which?p(t):9==t.which&&d(t)})}if(this.$inputDiv.hide(),"popup"==this.options.mode?$("body").append(this.$inputDiv):this.$element.after(this.$inputDiv),this.$inputDiv.append(s),"select"!=e&&"datetimepicker"!=e&&this.options.clearButton===!0&&0===$.betterEditableData.utils.getIEVersion()){var u=$("<span></span>").addClass("editable-clear-button").text("✖");"multifield"==e?u.text("Clear").addClass("editable-button"):u.text("✖"),u.on("click",function(){t.clearInputValue(),t.focus()});var b=$("<div></div>").addClass("editable-clear-wrapper");b.append(this.$input),b.append(u),s.append(b)}else s.append(this.$input);if("datetimepicker"==e){var h=$.extend({},this.options.typeSettings);"undefined"==typeof h.debug&&(h.debug=!0),"undefined"==typeof h.inline&&(h.inline=!0),this.options.clearButton===!0&&"undefined"==typeof h.showClear&&(h.showClear=!0),this.options.buttonsOn===!1&&"undefined"==typeof h.showClose&&(h.showClose=!0,this.$input.on("dp.hide",function(){t.cancel()})),this.$input.datetimepicker(h),"undefined"==typeof h.useCurrent||h.useCurrent===!0||"undefined"!=typeof h.defaultDate?this.setValue(this.getInputValue()):(this.$input.datetimepicker("clear"),this.setInputValue(this.getValue()))}if(this.options.buttonsOn===!0){var f=$("<div></div>").addClass("editable-button-wrapper"),c=$("<span></span>").addClass("editable-button").addClass(t.options.buttonClass).text("✓");c.on("click",function(){t.initiateSubmit()});var m=$("<span></span>").addClass("editable-button").addClass(t.options.buttonClass).text("✖");m.on("click",function(){t.cancel()}),this.$inputDiv.append(f),f.append(c),f.append(m)}if("popup"==this.options.mode){var y=$("<div></div>").addClass("editable-popup-wrapper").addClass(this.options.placement);this.$inputDiv.wrapInner(y)}},BetterEditable.prototype.recreateInputField=function(t,e){t!==!1&&(t=!0);var i=this.getValue();this.isShown()&&this.hideInput(e),this.options.destroyError(this),this.$inputDiv.remove(),this.createInputField(),t&&(this.setValue(i),this.setInputValue()),this.options.displayFunction(this),this.$element.trigger("be.recreateInput",this)},BetterEditable.prototype.canBeShown=function(){return this.state.readOnly===!1&&this.state.popupOpen===!1&&!this.isShown()&&"bool"!==this.options.type},BetterEditable.prototype.isShown=function(){return"bool"==this.options.type||this.$inputDiv.is(":visible")},BetterEditable.prototype.isReadOnly=function(){return this.state.readOnly},BetterEditable.prototype.canTab=function(){return this.options.tabbingOn===!0&&!this.isReadOnly()&&("string"==typeof this.options.tabIndex||"number"==typeof this.options.tabIndex)},BetterEditable.prototype.show=function(){if(!this.canBeShown())return!1;if(this.state.isValid&&this.options.errorHandler("",this,!1),"popup"!==this.options.mode&&(this.$element.hide(),this.$inputDiv.show()),this.setInputValue(),this.$inputDiv.show(),"popup"===this.options.mode){this.togglePopupOpen(!0);var t=this.$element.offset().top,e=this.$element.offset().left;if("bottom"===this.options.placement)t+=7;else if("top"===this.options.placement){var i=this.$element.outerHeight();this.$inputDiv.children().first().outerHeight()>i&&(i=this.$inputDiv.children().first().outerHeight()),t-=i+7}else if("right"===this.options.placement)e+=this.$element.outerWidth()+7,t-=7;else if("left"===this.options.placement){var a=this.$element.outerWidth();this.$inputDiv.children().first().outerWidth()>a&&(a=this.$inputDiv.children().first().outerWidth()),e-=a+7,t-=7}this.$inputDiv.css("top",t+"px"),this.$inputDiv.css("left",e+"px")}this.focus(),this.$element.trigger("be.shown",this)},BetterEditable.prototype.hideInput=function(t){this.$inputDiv.hide(),this.$element.show(),("popup"===this.options.mode||t===!0)&&this.togglePopupOpen(!1),this.$element.trigger("be.hidden",this)},BetterEditable.prototype.initiateSubmit=function(t,e){if("undefined"!=typeof t&&this.$input.val(t),e!==!0&&this.options.submitNoChange===!1&&this.getValue()==this.getInputValue())return this.cancel(),this.state.doTab!==!1&&this.triggerTabbing(this.state.doTab),this.resetState();var i=this.submitProcess();i!==!0&&this.hideInput()},BetterEditable.prototype.cancel=function(){this.options.errorHandler("",this,!1),this.hideInput(),this.$element.trigger("be.cancelled",this)},BetterEditable.prototype.triggerTabbing=function(t,e){if(!this.canTab())return!1;var i=Number(this.options.tabIndex);if("object"==typeof e&&null!==e?i=e.data("tab-index"):(i+=t,e=$('[data-editable][data-tab-index="'+i+'"]')),e.length>0){var a={};this.$element.trigger("be.beforeTab",{direction:t,nextTab:i,editable:this,returnData:a});a.flag!==!1&&(e=e.first(),e.is(":visible")&&"bool"!==e.betterEditable().options.type?e.betterEditable().show():e.betterEditable().triggerTabbing(t))}return!0},BetterEditable.prototype.focus=function(){if("multifield"==this.options.type)for(var t=this.$input.children().first();t.length>0;){if(t.hasClass("editable-multifield-input-wrapper")){var e=t.find('input:not([type="checkbox"])').first();if(e.length>0){e.focus();break}if(e=t.find("textarea").first(),e.length>0){e.focus();break}}t=t.next()}else this.$input.focus()},BetterEditable.prototype.setValue=function(t){"bool"==this.options.type?t=$.betterEditableData.utils.normalizeBoolean(t):"number"==this.options.type&&(t=$.betterEditableData.utils.normalizeNumber(t));var e=this.getValue();return this.value=t,this.$element.trigger("be.change",{newValue:t,oldValue:e,editable:this}),e},BetterEditable.prototype.getValue=function(){return this.value},BetterEditable.prototype.setInputValue=function(t){var e=this;if("undefined"==typeof t&&(t=this.getValue()),"datetimepicker"==this.options.type){var i=this.$input.data("DateTimePicker");null===t||"string"==typeof t&&""===t.trim()?(this.$input.datetimepicker("clear"),t=""):(isNaN(Date.parse(t))?i.date(t):i.date(new Date(t)),t=null!==i.date()?i.date().format(this.$input.data("DateTimePicker").format()):""),this.$input.val(t)}else if("multifield"==this.options.type)for(var a=0;a<t.length;++a)Object.keys(t[a]).forEach(function(i){var n=e.$input.find('input[name="'+i+'"]').first();n.length>0?"checkbox"===n.attr("type")?n.prop("checked",$.betterEditableData.utils.normalizeBoolean(t[a][i])):n.val(t[a][i]):(n=e.$input.find('textarea[name="'+i+'"]').first(),n.length>0&&n.val(t[a][i]))});else this.$input.val(t)},BetterEditable.prototype.getInputValue=function(){var t=this.$input.val();if("bool"==this.options.type)"boolean"!=typeof t&&(t="string"==typeof t&&"true"==t.toLowerCase()?!0:!1);else if("datetimepicker"==this.options.type)t=this.$input.data("DateTimePicker").date();else if("multifield"==this.options.type){t=[];var e="",i="";this.$input.children().each(function(){var a=$(this).find("input");if(0===a.length&&(a=$(this).find("textarea")),1===a.length&&(e=a.attr("name"),"string"==typeof e&&""!==e.trim())){i="checkbox"==a.attr("type")?a[0].checked:a.val();var n={};n[e]=i,t.push(n)}})}return t},BetterEditable.prototype.clearInputValue=function(){"datetimepicker"==this.options.type?this.$input.datetimepicker("clear"):"multifield"==this.options.type?(this.$input.find("input").each(function(){"checkbox"==$(this).attr("type")?$(this).prop("checked",!1):$(this).val("")}),this.$input.find("textarea").each(function(){$(this).val("")})):this.$input.val("")},BetterEditable.prototype.togglePopupOpen=function(t){t!==!0&&t!==!1&&(t=!this.state.popupOpen),t===!0?this.$element.hasClass("popup-open")||this.$element.addClass("popup-open"):this.$element.removeClass("popup-open"),this.state.popupOpen=t},BetterEditable.prototype.toggleReadOnly=function(t){t!==!0&&t!==!1&&(t=!this.state.readOnly),t===!0?(this.isShown()&&this.cancel(),this.$element.hasClass("disabled")||this.$element.addClass("disabled")):this.$element.removeClass("disabled"),this.$element.prop("disabled",t),this.state.readOnly=t},BetterEditable.prototype.resetState=function(){this.state.isValid=!0,this.state.doTab=!1},BetterEditable.prototype.submitProcess=function(){this.options.errorHandler("",this,!1);var t=this.validate();return t?t=this.submitData():!0},BetterEditable.prototype.validate=function(t){var e=this.getInputValue();this.isShown()||(e=this.getValue());var i=this,a={};if(this.$element.trigger("be.beforeValidate",{newValue:e,editable:i,returnData:a}),a.flag===!1)return!1;for(var n=0;n<this.validators.length;++n){var o=this.$element.data(this.validators[n]+"-val");"undefined"==typeof o&&(o=this.$element.data(this.validators[n]));var s=$.betterEditableData.validators[this.validators[n]].validator(e,o,this.$element);if(s===!1){var r=this.$element.data(this.validators[n]+"-msg");return"string"!=typeof r&&(r=$.betterEditableData.validators[this.validators[n]].errorMsg(this.options.fieldName,o,this.$element)),t!==!1&&this.options.errorHandler(r,this,!0),this.state.isValid=!1,this.$element.trigger("be.failedValidation",{newValue:e,editable:i}),!1}}return!0},BetterEditable.prototype.processSubmitData=function(t){if("datetimepicker"===this.options.type)null!==t&&(t=t.format(this.$input.data("DateTimePicker").format()));else if("multifield"===this.options.type&&"[object Array]"===Object.prototype.toString.call(t))if(0===t.length)t=null;else{for(var e={},i=0;i<t.length;++i)Object.keys(t[i]).forEach(function(a){e[a]=t[i][a]});t=e}return t},BetterEditable.prototype.submitData=function(){var t=this.getInputValue();this.isShown()||(t=this.getValue());var e=this.getValue();this.setValue(t);var i=this;t=this.processSubmitData(t);var a={submitData:t};if(this.$element.trigger("be.beforeSubmit",{editable:i,returnData:a}),a.flag===!1)return!0;t=a.submitData;var n=$.extend({},this.options.ajaxParams);"object"==typeof t&&null!==t?Object.keys(t).forEach(function(e){"undefined"==typeof n[e]&&(n[e]=t[e])}):"undefined"==typeof n.value&&(n.value=t),"undefined"==typeof n.fieldName&&(n.fieldName=this.options.fieldName),"undefined"==typeof n.pk&&(n.pk=this.options.pk);var o=$.extend({},this.options.ajaxObject);"undefined"==typeof o.url&&(o.url=this.options.url),"undefined"==typeof o.type&&(o.type="POST"),"undefined"==typeof o.data&&(o.data=n),"undefined"==typeof o.beforeSend&&(o.beforeSend=function(){i.options.load.start(i)}),"undefined"==typeof o.success&&(o.success=function(t){i.options.onAjaxSuccess(t,i),i.state.doTab!==!1&&(--$.betterEditableData.submitting,i.triggerTabbing(i.state.doTab)),i.$element.trigger("be.ajaxSuccess",{response:t,editable:i,oldValue:e}),i.afterProcess()}),"undefined"==typeof o.error&&(o.error=function(t,a,n,o){i.state.isValid=!1;var s=i.getValue();i.setValue(e),i.options.onAjaxError(t,a,n,o,s,i),i.state.doTab!==!1&&--$.betterEditableData.submitting,i.$element.trigger("be.ajaxError",{errorObj:t,xhr:a,settings:n,exception:o,errorValue:s,editable:i}),i.afterProcess()}),"string"==typeof o.url&&""!==o.url?(i.state.doTab!==!1&&++$.betterEditableData.submitting,$.ajax(o)):(this.options.displayFunction(this),i.state.doTab!==!1&&i.triggerTabbing(i.state.doTab),this.afterProcess())},BetterEditable.prototype.afterProcess=function(){this.resetState()},$.fn.betterEditable=function(t){if("string"!=typeof t)return"object"!=typeof this.data("betterEditable")&&(("object"!=typeof t||null===t)&&(t={}),t.$element=this,this.data("betterEditable",new BetterEditable(t))),this.data("betterEditable");var e=t;if("object"==typeof this.data("betterEditable")&&"function"==typeof $.betterEditableData.methods[e]){var i=[].slice.call(arguments);return i.shift(),i.unshift(this.data("betterEditable")),$.betterEditableData.methods[e].apply(null,i)}},$.initializeEditables=function(t){$("[data-editable]:not([data-editable-no-init])").each(function(){$(this).betterEditable(t)})},$(document).on("keydown",function(t){9==t.which&&($.betterEditableData.submitting>0&&$.betterEditableData.blockTab===!0?$.betterEditableData.utils.preventDefault(t):0===$.betterEditableData.submitting&&0==$("[data-editable-div]:visible").length&&(!t.shiftKey&&$("[data-editable-first-tab]:visible").length>0&&"object"==typeof $("[data-editable-first-tab]:visible").first().betterEditable()&&null!==$("[data-editable-first-tab]:visible").first().betterEditable()&&1==$("[data-editable-first-tab]:visible").first().betterEditable().options.tabbingOn?($.betterEditableData.utils.preventDefault(t),$("[data-editable-first-tab]:visible").first().betterEditable().triggerTabbing(1,$("[data-editable-first-tab]:visible").first())):t.shiftKey&&$("[data-editable-last-tab]:visible").length>0&&"object"==typeof $("[data-editable-last-tab]:visible").first().betterEditable()&&null!==$("[data-editable-last-tab]:visible").first().betterEditable()&&1==$("[data-editable-last-tab]:visible").first().betterEditable().options.tabbingOn&&($.betterEditableData.utils.preventDefault(t),$("[data-editable-last-tab]:visible").first().betterEditable().triggerTabbing(-1,$("[data-editable-last-tab]:visible").first()))))})}();